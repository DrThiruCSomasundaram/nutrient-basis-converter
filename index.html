<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>International Community of Practice on Nutrient Composition of Aquatic Foods</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            display: none;
        }
        .nutrient-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        .nutrient-row input, .nutrient-row select {
            width: 100%;
        }
        .nutrient-row label {
            min-width: 0;
        }
        .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            width: auto;
        }
        .remove-btn:hover {
            background-color: #c82333;
        }
        .add-btn {
            background-color: #007bff;
        }
        .add-btn:hover {
            background-color: #0056b3;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .results-table th, .results-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .results-table th {
            background-color: #f2f2f2;
        }
        .header-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .header-row div {
            padding: 8px;
        }
        .basis-selector {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .basis-selector label {
            display: inline-block;
            margin-right: 20px;
        }
        .basis-selector input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }
        .ash-content {
            display: none;
        }
        .download-btn {
            background-color: #28a745;
            margin-top: 10px;
        }
        .download-btn:hover {
            background-color: #218838;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .header p {
            color: #34495e;
            font-size: 1.1em;
            line-height: 1.4;
        }
        .citation-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .citation-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .citation-text {
            background-color: #fff;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
        }
        .download-citation {
            display: inline-block;
            margin-right: 10px;
        }
        .license-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }
        .license-section img {
            margin: 10px 0;
        }
        .footer {
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #ddd;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>International Community of Practice on Nutrient Composition of Aquatic Foods</h1>
            <p>Data guidelines for publishing high quality food composition data</p>
        </div>
        <form id="converterForm">
            <div class="basis-selector">
                <label>
                    <input type="checkbox" id="dryMatterBasis" checked> Convert to Dry Matter Basis
                </label>
                <label>
                    <input type="checkbox" id="ashFreeBasis"> Convert to Ash-Free Dry Matter Basis
                </label>
            </div>

            <div id="nutrientsContainer">
                <h3>Nutrients</h3>
                <div class="header-row">
                    <div>Nutrient</div>
                    <div>Content</div>
                    <div>Moisture Content (%)</div>
                    <div class="ash-content">Ash Content (%)</div>
                    <div>Base</div>
                    <div>Current Unit</div>
                    <div>Conversion Unit</div>
                    <div>Current Value</div>
                    <div>Dry Matter Basis</div>
                    <div class="ash-free-content">Ash Free Dry Matter Basis</div>
                    <div></div>
                </div>
                <div class="nutrient-row">
                    <input type="text" placeholder="Nutrient" class="nutrient-label">
                    <input type="number" placeholder="Content" class="nutrient-value">
                    <input type="number" placeholder="Moisture Content (%)" class="moisture-content">
                    <input type="number" placeholder="Ash Content (%)" class="ash-content">
                    <select class="basis">
                        <option value="wet">Wet Weight Base</option>
                        <option value="dry">Dry Weight Base</option>
                    </select>
                    <select class="input-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <select class="output-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <input type="text" readonly placeholder="Current Value" class="original-value">
                    <input type="text" readonly placeholder="Dry Matter Basis" class="dry-matter-value">
                    <input type="text" readonly placeholder="Ash Free Dry Matter Basis" class="ash-free-value">
                    <button type="button" class="remove-nutrient">Ã—</button>
                </div>
                <div class="nutrient-row">
                    <input type="text" placeholder="Nutrient" class="nutrient-label">
                    <input type="number" placeholder="Content" class="nutrient-value">
                    <input type="number" placeholder="Moisture Content (%)" class="moisture-content">
                    <input type="number" placeholder="Ash Content (%)" class="ash-content">
                    <select class="basis">
                        <option value="wet">Wet Weight Base</option>
                        <option value="dry">Dry Weight Base</option>
                    </select>
                    <select class="input-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <select class="output-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <input type="text" readonly placeholder="Current Value" class="original-value">
                    <input type="text" readonly placeholder="Dry Matter Basis" class="dry-matter-value">
                    <input type="text" readonly placeholder="Ash Free Dry Matter Basis" class="ash-free-value">
                    <button type="button" class="remove-nutrient">Ã—</button>
                </div>
                <div class="nutrient-row">
                    <input type="text" placeholder="Nutrient" class="nutrient-label">
                    <input type="number" placeholder="Content" class="nutrient-value">
                    <input type="number" placeholder="Moisture Content (%)" class="moisture-content">
                    <input type="number" placeholder="Ash Content (%)" class="ash-content">
                    <select class="basis">
                        <option value="wet">Wet Weight Base</option>
                        <option value="dry">Dry Weight Base</option>
                    </select>
                    <select class="input-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <select class="output-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <input type="text" readonly placeholder="Current Value" class="original-value">
                    <input type="text" readonly placeholder="Dry Matter Basis" class="dry-matter-value">
                    <input type="text" readonly placeholder="Ash Free Dry Matter Basis" class="ash-free-value">
                    <button type="button" class="remove-nutrient">Ã—</button>
                </div>
                <div class="nutrient-row">
                    <input type="text" placeholder="Nutrient" class="nutrient-label">
                    <input type="number" placeholder="Content" class="nutrient-value">
                    <input type="number" placeholder="Moisture Content (%)" class="moisture-content">
                    <input type="number" placeholder="Ash Content (%)" class="ash-content">
                    <select class="basis">
                        <option value="wet">Wet Weight Base</option>
                        <option value="dry">Dry Weight Base</option>
                    </select>
                    <select class="input-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <select class="output-unit">
                        <option value="percent">%</option>
                        <option value="g/kg">g/kg</option>
                        <option value="mg/kg">mg/kg</option>
                        <option value="g/100g">g/100g</option>
                        <option value="mg/100g">mg/100g</option>
                    </select>
                    <input type="text" readonly placeholder="Current Value" class="original-value">
                    <input type="text" readonly placeholder="Dry Matter Basis" class="dry-matter-value">
                    <input type="text" readonly placeholder="Ash Free Dry Matter Basis" class="ash-free-value">
                    <button type="button" class="remove-nutrient">Ã—</button>
                </div>
            </div>

            <button type="button" id="addNutrient" class="add-btn">Add Another Nutrient</button>
            <button type="submit">Convert All</button>
        </form>

        <div id="result" class="result">
            <h3>Results:</h3>
            <div class="results-table">
                <table>
                    <thead>
                        <tr>
                            <th>Nutrient</th>
                            <th>Content</th>
                            <th>Moisture Content (%)</th>
                            <th>Ash Content (%)</th>
                            <th>Base</th>
                            <th>Current Unit</th>
                            <th>Conversion Unit</th>
                            <th>Current Value</th>
                            <th>Dry Matter Basis</th>
                            <th>Ash Free Dry Matter Basis</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                    </tbody>
                </table>
            </div>
            <button type="button" id="downloadPdf" class="download-btn">Download Results as PDF</button>
        </div>

        <div class="citation-section">
            <h3>How to Cite</h3>
            <div class="citation-text">
                <p>International Community of Practice on Nutrient Composition of Aquatic Foods. (2025). Nutrient Basis Converter [Computer software]. https://drthirucsomasundaram.github.io/nutrient-basis-converter/</p>
            </div>
            <div class="download-citation">
                <button type="button" id="downloadRis" class="download-btn">Download RIS File</button>
            </div>
        </div>

        <div class="license-section">
            <h3>License</h3>
            <p>This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</p>
            <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="Creative Commons">
            <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="Attribution">
        </div>

        <div class="footer">
            <p>Â© 2025 International Community of Practice on Nutrient Composition of Aquatic Foods</p>
        </div>
    </div>

    <script>
        // Toggle ash content fields visibility
        document.getElementById('ashFreeBasis').addEventListener('change', function() {
            const ashFields = document.querySelectorAll('.ash-content, .ash-free-content');
            ashFields.forEach(field => {
                field.style.display = this.checked ? 'block' : 'none';
            });
        });

        // Add new nutrient row
        document.getElementById('addNutrient').addEventListener('click', function() {
            const container = document.getElementById('nutrientsContainer');
            const newRow = document.createElement('div');
            newRow.className = 'nutrient-row';
            newRow.innerHTML = `
                <input type="text" placeholder="Nutrient" class="nutrient-label">
                <input type="number" placeholder="Content" class="nutrient-value">
                <input type="number" placeholder="Moisture Content (%)" class="moisture-content">
                <input type="number" placeholder="Ash Content (%)" class="ash-content">
                <select class="basis">
                    <option value="wet">Wet Weight Base</option>
                    <option value="dry">Dry Weight Base</option>
                </select>
                <select class="input-unit">
                    <option value="percent">%</option>
                    <option value="g/kg">g/kg</option>
                    <option value="mg/kg">mg/kg</option>
                    <option value="g/100g">g/100g</option>
                    <option value="mg/100g">mg/100g</option>
                </select>
                <select class="output-unit">
                    <option value="percent">%</option>
                    <option value="g/kg">g/kg</option>
                    <option value="mg/kg">mg/kg</option>
                    <option value="g/100g">g/100g</option>
                    <option value="mg/100g">mg/100g</option>
                </select>
                <input type="text" readonly placeholder="Current Value" class="original-value">
                <input type="text" readonly placeholder="Dry Matter Basis" class="dry-matter-value">
                <input type="text" readonly placeholder="Ash Free Dry Matter Basis" class="ash-free-value">
                <button type="button" class="remove-nutrient">Ã—</button>
            `;
            container.appendChild(newRow);
        });

        // Remove nutrient row
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-nutrient')) {
                const row = e.target.parentElement;
                if (document.querySelectorAll('.nutrient-row').length > 4) {
                    row.remove();
                }
            }
        });

        // Convert between units
        function convertUnit(value, fromUnit, toUnit) {
            // First convert to percentage as base unit
            let percentageValue;
            switch(fromUnit) {
                case 'percentage':
                    percentageValue = value;
                    break;
                case 'g/kg':
                    percentageValue = value / 10;
                    break;
                case 'mg/kg':
                    percentageValue = value / 10000;
                    break;
                case 'g/100g':
                    percentageValue = value;
                    break;
                case 'mg/100g':
                    percentageValue = value / 1000;
                    break;
            }

            // Then convert from percentage to target unit
            switch(toUnit) {
                case 'percentage':
                    return percentageValue;
                case 'g/kg':
                    return percentageValue * 10;
                case 'mg/kg':
                    return percentageValue * 10000;
                case 'g/100g':
                    return percentageValue;
                case 'mg/100g':
                    return percentageValue * 1000;
            }
        }

        // Handle form submission
        document.getElementById('converterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const isDryMatter = document.getElementById('dryMatterBasis').checked;
            const isAshFree = document.getElementById('ashFreeBasis').checked;
            
            // Get all nutrient rows
            const nutrientRows = document.querySelectorAll('.nutrient-row');
            const results = [];
            
            nutrientRows.forEach(row => {
                const label = row.querySelector('.nutrient-label').value;
                const value = parseFloat(row.querySelector('.nutrient-value').value);
                const moistureContent = parseFloat(row.querySelector('.moisture-content').value);
                const ashContent = isAshFree ? parseFloat(row.querySelector('.ash-content').value) : 0;
                const basis = row.querySelector('.basis').value;
                const inputUnit = row.querySelector('.input-unit').value;
                const outputUnit = row.querySelector('.output-unit').value;
                
                // Convert to dry matter basis
                let dryMatterValue = 0;
                let ashFreeValue = 0;
                
                if (isDryMatter) {
                    // For dry matter basis, we need to account for moisture in both wet and dry weight basis
                    dryMatterValue = value * (100 / (100 - moistureContent));
                }
                
                if (isAshFree) {
                    // For ash-free basis, we need to account for both moisture and ash
                    ashFreeValue = value * (100 / (100 - moistureContent - ashContent));
                }
                
                // Convert between units
                const finalDryMatterValue = isDryMatter ? convertUnit(dryMatterValue, inputUnit, outputUnit) : 0;
                const finalAshFreeValue = isAshFree ? convertUnit(ashFreeValue, inputUnit, outputUnit) : 0;
                
                // Update the row with results
                row.querySelector('.original-value').value = `${value.toFixed(2)} ${inputUnit}`;
                row.querySelector('.dry-matter-value').value = isDryMatter ? `${finalDryMatterValue.toFixed(2)} ${outputUnit}` : '';
                row.querySelector('.ash-free-value').value = isAshFree ? `${finalAshFreeValue.toFixed(2)} ${outputUnit}` : '';
                
                results.push({
                    label,
                    originalValue: `${value.toFixed(2)} ${inputUnit}`,
                    dryMatterValue: isDryMatter ? `${finalDryMatterValue.toFixed(2)} ${outputUnit}` : '',
                    ashFreeValue: isAshFree ? `${finalAshFreeValue.toFixed(2)} ${outputUnit}` : ''
                });
            });
            
            // Display results in table
            const resultsBody = document.getElementById('resultsBody');
            resultsBody.innerHTML = '';
            
            results.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.label}</td>
                    <td>${result.originalValue}</td>
                    <td>${result.dryMatterValue}</td>
                    <td class="ash-free-content">${result.ashFreeValue}</td>
                `;
                resultsBody.appendChild(row);
            });
            
            document.getElementById('result').style.display = 'block';
        });

        // Download RIS file
        document.getElementById('downloadRis').addEventListener('click', function() {
            const risContent = `TY  - COMP
TI  - Nutrient Basis Converter
AU  - International Community of Practice on Nutrient Composition of Aquatic Foods
AU  - [Working Group]
PY  - 2025
UR  - https://drthirucsomasundaram.github.io/nutrient-basis-converter/
ER  - `;
            
            const blob = new Blob([risContent], { type: 'application/x-research-info-systems' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'nutrient_basis_converter.ris';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        });

        // Update PDF download to include citation
        document.getElementById('downloadPdf').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(16);
            doc.text('International Community of Practice on Nutrient Composition of Aquatic Foods', 14, 15);
            doc.setFontSize(12);
            doc.text('Nutrient Conversion Results', 14, 25);
            
            // Add citation
            doc.setFontSize(10);
            doc.text('Citation:', 14, 35);
            doc.text('International Community of Practice on Nutrient Composition of Aquatic Foods. (2025).', 14, 42);
            doc.text('Nutrient Basis Converter [Computer software].', 14, 49);
            doc.text('https://github.com/DrThiruCSomasundaram/nutrient-basis-converter', 14, 56);
            
            // Add conversion types
            doc.setFontSize(12);
            const isDryMatter = document.getElementById('dryMatterBasis').checked;
            const isAshFree = document.getElementById('ashFreeBasis').checked;
            let conversionTypes = [];
            if (isDryMatter) conversionTypes.push('Dry Matter Basis');
            if (isAshFree) conversionTypes.push('Ash-Free Dry Matter Basis');
            doc.text(`Conversion Types: ${conversionTypes.join(' and ')}`, 14, 66);
            
            // Get table data
            const tableData = [];
            const headers = ['Nutrient', 'Content', 'Moisture Content (%)', 'Ash Content (%)', 'Base', 'Current Unit', 'Conversion Unit', 'Current Value', 'Dry Matter Basis', 'Ash Free Dry Matter Basis'];
            document.querySelectorAll('#resultsBody tr').forEach(row => {
                const rowData = [];
                row.querySelectorAll('td').forEach(cell => {
                    rowData.push(cell.textContent);
                });
                tableData.push(rowData);
            });
            
            // Generate table
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 76,
                theme: 'grid',
                styles: { fontSize: 8 },
                columnStyles: {
                    0: { cellWidth: 30 },
                    1: { cellWidth: 20 },
                    2: { cellWidth: 25 },
                    3: { cellWidth: 25 },
                    4: { cellWidth: 25 },
                    5: { cellWidth: 25 },
                    6: { cellWidth: 25 },
                    7: { cellWidth: 25 },
                    8: { cellWidth: 25 },
                    9: { cellWidth: 25 }
                }
            });
            
            // Add license information
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(10);
            doc.text('This work is licensed under a Creative Commons Attribution 4.0 International License.', 14, finalY);
            
            // Save PDF
            doc.save('nutrient_conversion_results.pdf');
        });
    </script>
</body>
</html> 